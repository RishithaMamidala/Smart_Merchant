# Render Blueprint for Smart Merchant Backend
# Free tier deployment - $0/month
# NO GOOGLE OAUTH - Only 9 required environment variables

services:
  - type: web
    name: smartmerchant-backend
    runtime: node
    region: oregon  # Choose: oregon, frankfurt, singapore, ohio
    plan: free  # Free tier: spins down after 15 min inactivity
    rootDir: backend
    buildCommand: npm install
    startCommand: npm start
    healthCheckPath: /api/health
    autoDeploy: true
    branch: main

    # REQUIRED Environment Variables (9 total)
    # All marked 'sync: false' must be set manually in Render dashboard
    envVars:
      # 1. Server Configuration
      - key: NODE_ENV
        value: production

      # 2. Database (REQUIRED)
      - key: MONGODB_URI
        sync: false  # Your MongoDB Atlas connection string

      # 3. JWT Secrets (REQUIRED - generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))")
      - key: JWT_SECRET
        sync: false  # 64-character secret
      - key: JWT_REFRESH_SECRET
        sync: false  # 64-character secret
      - key: JWT_EXPIRES_IN
        value: 15m
      - key: JWT_REFRESH_EXPIRES_IN
        value: 7d

      # 4. Stripe (REQUIRED)
      - key: STRIPE_SECRET_KEY
        sync: false  # sk_test_... or sk_live_...
      - key: STRIPE_WEBHOOK_SECRET
        sync: false  # whsec_... (set after creating webhook)

      # 5. SendGrid Email (REQUIRED)
      - key: SENDGRID_API_KEY
        sync: false  # SG.xxxxx
      - key: SENDGRID_FROM_EMAIL
        sync: false  # your-email@example.com
      - key: SENDGRID_FROM_NAME
        value: Smart Merchant

      # 6. Cloudinary (OPTIONAL - leave blank if not using)
      - key: CLOUDINARY_CLOUD_NAME
        value: ""
      - key: CLOUDINARY_API_KEY
        value: ""
      - key: CLOUDINARY_API_SECRET
        value: ""

      # 7. Cron Jobs (REQUIRED - generate with: node -e "console.log(require('crypto').randomBytes(16).toString('hex'))")
      - key: CRON_SECRET
        sync: false  # 32-character secret

      # 8. CORS (REQUIRED - set after Vercel deployment)
      - key: FRONTEND_URL
        sync: false  # https://your-app.vercel.app (no trailing slash)
