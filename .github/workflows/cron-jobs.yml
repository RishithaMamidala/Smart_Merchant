name: Scheduled Cron Jobs

on:
  schedule:
    # Daily summary at 8:00 AM UTC
    - cron: '0 8 * * *'
    # Low stock check at 9:00 AM UTC
    - cron: '0 9 * * *'
    # Retry notifications every 15 minutes
    - cron: '*/15 * * * *'
    # Cleanup carts at 3:00 AM UTC
    - cron: '0 3 * * *'
    # Cleanup notifications at 4:00 AM Sunday
    - cron: '0 4 * * 0'
  workflow_dispatch: # Allow manual trigger

jobs:
  daily-summary:
    if: github.event.schedule == '0 8 * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Trigger daily summary
        run: |
          curl -X POST ${{ secrets.BACKEND_URL }}/api/cron/daily-summary \
            -H "X-Cron-Secret: ${{ secrets.CRON_SECRET }}"

  low-stock-check:
    if: github.event.schedule == '0 9 * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Trigger low stock check
        run: |
          curl -X POST ${{ secrets.BACKEND_URL }}/api/cron/low-stock-check \
            -H "X-Cron-Secret: ${{ secrets.CRON_SECRET }}"

  retry-notifications:
    if: github.event.schedule == '*/15 * * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Trigger retry notifications
        run: |
          curl -X POST ${{ secrets.BACKEND_URL }}/api/cron/retry-notifications \
            -H "X-Cron-Secret: ${{ secrets.CRON_SECRET }}"

  cleanup-carts:
    if: github.event.schedule == '0 3 * * *' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Trigger cleanup carts
        run: |
          curl -X POST ${{ secrets.BACKEND_URL }}/api/cron/cleanup-carts \
            -H "X-Cron-Secret: ${{ secrets.CRON_SECRET }}"

  cleanup-notifications:
    if: github.event.schedule == '0 4 * * 0' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-latest
    steps:
      - name: Trigger cleanup notifications
        run: |
          curl -X POST ${{ secrets.BACKEND_URL }}/api/cron/cleanup-notifications \
            -H "X-Cron-Secret: ${{ secrets.CRON_SECRET }}"
